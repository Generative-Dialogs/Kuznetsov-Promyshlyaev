<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: Исходный файл C:/Users/kir/Desktop/py/API/src/GameMaster/GameMaster.py</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">My Project
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Поиск" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Создано системой Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('_game_master_8py_source.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Загрузка...</div>
<div class="SRStatus" id="Searching">Поиск...</div>
<div class="SRStatus" id="NoMatches">Не найдено</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">GameMaster.py</div></div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="keyword">import</span> time</div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="keyword">from</span> typing <span class="keyword">import</span> Optional, Dict, List, Tuple, Set</div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="keyword">from</span> <a class="code hl_namespace" href="namespacesrc_1_1_game_master_1_1_command_data.html">src.GameMaster.CommandData</a> <span class="keyword">import</span> CommandData, CommandDataEnvironmentDescription, CommandSelectCharacter, \</div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span>    CommandCreateCharacter, CommandOffTopic, CommandPlayerDeath</div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="keyword">from</span> <a class="code hl_namespace" href="namespacesrc_1_1_message_generator_1_1_message_generator_open_router.html">src.MessageGenerator.MessageGeneratorOpenRouter</a> <span class="keyword">import</span> MessageGeneratorOpenRouter</div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="keyword">from</span> <a class="code hl_namespace" href="namespacesrc_1_1_actor_1_1_protocol_actor.html">src.Actor.ProtocolActor</a> <span class="keyword">import</span> ProtocolActor</div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="keyword">from</span> <a class="code hl_namespace" href="namespacesrc_1_1_actor_1_1_actor.html">src.Actor.Actor</a> <span class="keyword">import</span> Actor</div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="keyword">from</span> <a class="code hl_namespace" href="namespacesrc_1_1_message_generator_1_1_protocol_message_generator.html">src.MessageGenerator.ProtocolMessageGenerator</a> <span class="keyword">import</span> ProtocolMessageGenerator</div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="keyword">from</span> <a class="code hl_namespace" href="namespacesrc_1_1_game_master_1_1_game_master_promts.html">src.GameMaster.GameMasterPromts</a> <span class="keyword">import</span> start_message, world_description_start, correct_formatting, \</div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span>    character_name_start</div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="keyword">from</span> <a class="code hl_namespace" href="namespacesrc_1_1_descriptions_1_1_character_decription.html">src.Descriptions.CharacterDecription</a> <span class="keyword">import</span> base_character_description</div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="keyword">from</span> <a class="code hl_namespace" href="namespacesrc_1_1_descriptions_1_1_world_decription.html">src.Descriptions.WorldDecription</a> <span class="keyword">import</span> base_world_description</div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="keyword">from</span> <a class="code hl_namespace" href="namespacesrc_1_1_database_manager_1_1_database_manager.html">src.DatabaseManager.DatabaseManager</a> <span class="keyword">import</span> DatabaseManager</div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="keyword">from</span> <a class="code hl_namespace" href="namespacesrc_1_1_image_manager_1_1_image_manager.html">src.ImageManager.ImageManager</a> <span class="keyword">import</span> ImageManager</div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="keyword">import</span> logging</div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span> </div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span> </div>
<div class="foldopen" id="foldopen00018" data-start="" data-end="">
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno"><a class="line" href="classsrc_1_1_game_master_1_1_game_master_1_1_player_death_exception.html">   18</a></span><span class="keyword">class </span><a class="code hl_class" href="classsrc_1_1_game_master_1_1_game_master_1_1_player_death_exception.html">PlayerDeathException</a>(Exception):</div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span>    <span class="stringliteral">&quot;&quot;&quot;!</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="stringliteral">    @brief Исключение, возникающее при смерти игрового персонажа</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="stringliteral">    </span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="stringliteral">    @details</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="stringliteral">    Выбрасывается, когда игровой персонаж умирает, что приводит к завершению сессии</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span><span class="stringliteral">    и блокировке дальнейшего ввода.</span></div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span>    <span class="keywordflow">pass</span></div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span> </div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span> </div>
</div>
<div class="foldopen" id="foldopen00029" data-start="" data-end="">
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno"><a class="line" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html">   29</a></span><span class="keyword">class </span><a class="code hl_class" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html">GameMaster</a>:</div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span>    <span class="stringliteral">&quot;&quot;&quot;!</span></div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span><span class="stringliteral">    @brief Класс, управляющий игровым процессом и взаимодействием с игроком</span></div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span><span class="stringliteral">    </span></div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span><span class="stringliteral">    @details</span></div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span><span class="stringliteral">    Отвечает за:</span></div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span><span class="stringliteral">    - Генерацию ответов на действия игрока</span></div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span><span class="stringliteral">    - Управление игровыми персонажами</span></div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span><span class="stringliteral">    - Поддержание целостности игрового мира</span></div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span><span class="stringliteral">    - Генерацию изображений</span></div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span><span class="stringliteral">    - Взаимодействие с базой данных</span></div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span><span class="stringliteral">    </span></div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span><span class="stringliteral">    @note Реализует паттерн Singleton для обеспечения единой точки управления игровым процессом</span></div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="foldopen" id="foldopen00043" data-start="" data-end="">
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno"><a class="line" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#a3d4c57cdc4cd784782f1fdb024610892">   43</a></span>    <span class="keyword">def </span><a class="code hl_function" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#a3d4c57cdc4cd784782f1fdb024610892">__init__</a>(self, session_id: int, world_description: Optional[str] = <span class="keywordtype">None</span>,</div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span>                 player_description: Optional[str] = <span class="keywordtype">None</span>,</div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span>                 fast_flg: bool = <span class="keyword">True</span>, language: str = <span class="stringliteral">&quot;English&quot;</span>,</div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span>                 generate_character_images: bool = <span class="keyword">True</span>) -&gt; <span class="keywordtype">None</span>:</div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span>        <span class="stringliteral">&quot;&quot;&quot;!</span></div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span><span class="stringliteral">        @brief Инициализация мастера игры</span></div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span><span class="stringliteral">        </span></div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span><span class="stringliteral">        @param session_id ID игровой сессии</span></div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span><span class="stringliteral">        @param world_description Описание игрового мира (опционально)</span></div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span><span class="stringliteral">        @param player_description Описание игрового персонажа (опционально)</span></div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span><span class="stringliteral">        @param fast_flg Флаг быстрого режима (опционально)</span></div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span><span class="stringliteral">        @param language Язык игры (опционально)</span></div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span><span class="stringliteral">        @param generate_character_images Флаг генерации изображений персонажей (опционально)</span></div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span>        self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#a163bdf238c24c30500cb4d758cd25b31">session_id</a> = session_id</div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>        self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#a7fcc819f6b191473b29534ab67576211">db</a> = <a class="code hl_class" href="classsrc_1_1_database_manager_1_1_database_manager_1_1_database_manager.html">DatabaseManager</a>()</div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>        self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#ab19b9e393d293c94e4643cd32c67d0dd">generate_character_images</a> = generate_character_images</div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span>        </div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>        <span class="keywordflow">if</span> world_description <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>            world_description = base_world_description</div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>        <span class="keywordflow">if</span> player_description <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>            player_description = base_character_description</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>            </div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>        self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#aaebaf89191e3696ae060994b3cbd85bd">world_description</a> = world_description</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>        self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#a0bb1f23554cf5091cf4bffb1641d9be6">player_description</a> = player_description</div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span> </div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>        self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#aedb06b2bcc0533a886a217a19735151d">messageGenerator</a>: ProtocolMessageGenerator = <a class="code hl_class" href="classsrc_1_1_message_generator_1_1_message_generator_open_router_1_1_message_generator_open_router.html">MessageGeneratorOpenRouter</a>()</div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>        self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#ab5359c63c972052f22645b0d60df5c38">characters</a>: Dict[str, str] = {}  <span class="comment"># name -&gt; description</span></div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span>        self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#ace910641bfd7d3f2a1421aecaea522dd">__actor</a> = <a class="code hl_class" href="classsrc_1_1_actor_1_1_actor_1_1_actor.html">Actor</a>(self, session_id,  fast_flg=fast_flg, language=language)</div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>        self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#ae450110ca0fd166f5a1cf036d7a42faa">__image_manager</a> = <a class="code hl_class" href="classsrc_1_1_image_manager_1_1_image_manager_1_1_image_manager.html">ImageManager</a>(session_id)</div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span> </div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>        logging.basicConfig(filename=<span class="stringliteral">&#39;game_master.log&#39;</span>, level=logging.INFO,</div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span>                          format=<span class="stringliteral">&#39;%(asctime)s - %(message)s&#39;</span>, filemode=<span class="stringliteral">&#39;a&#39;</span>)</div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span> </div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>        formatted_character: str = \</div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>            f<span class="stringliteral">&#39;&#39;&#39;</span></div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span><span class="stringliteral">        {character_name_start}</span></div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span><span class="stringliteral">        Description: {player_description}</span></div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span><span class="stringliteral">        &#39;&#39;&#39;</span></div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span> </div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>        is_new_session = self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#a7fcc819f6b191473b29534ab67576211">db</a>.is_new_session_gm_prompt(session_id)</div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>        </div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>        <span class="keywordflow">if</span> is_new_session:</div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>            <span class="comment"># For new session, generate and save initial prompts</span></div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>            <span class="keywordflow">if</span> fast_flg:</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>                <span class="comment"># Start message</span></div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>                self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#aedb06b2bcc0533a886a217a19735151d">messageGenerator</a>.add_system_message(start_message)</div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>                response = <span class="stringliteral">&quot;Understood&quot;</span></div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>                self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#aedb06b2bcc0533a886a217a19735151d">messageGenerator</a>.add_ai_message(response)</div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>                self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#a7fcc819f6b191473b29534ab67576211">db</a>.save_game_master_prompt(session_id, <span class="stringliteral">&quot;start&quot;</span>, start_message, response)</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>                </div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>                <span class="comment"># World description</span></div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>                world_prompt = world_description_start + <span class="stringliteral">&#39;\n&#39;</span> + self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#aaebaf89191e3696ae060994b3cbd85bd">world_description</a></div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>                self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#aedb06b2bcc0533a886a217a19735151d">messageGenerator</a>.add_user_message(world_prompt)</div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>                response = <span class="stringliteral">&quot;Understood&quot;</span></div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>                self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#aedb06b2bcc0533a886a217a19735151d">messageGenerator</a>.add_system_message(response)</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>                self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#a7fcc819f6b191473b29534ab67576211">db</a>.save_game_master_prompt(session_id, <span class="stringliteral">&quot;world&quot;</span>, world_prompt, response)</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>                </div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>                <span class="comment"># Character description</span></div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>                self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#aedb06b2bcc0533a886a217a19735151d">messageGenerator</a>.add_user_message(formatted_character)</div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>                response = <span class="stringliteral">&quot;Understood&quot;</span></div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>                self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#aedb06b2bcc0533a886a217a19735151d">messageGenerator</a>.add_system_message(response)</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>                self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#a7fcc819f6b191473b29534ab67576211">db</a>.save_game_master_prompt(session_id, <span class="stringliteral">&quot;character&quot;</span>, formatted_character, response)</div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>            <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>                <span class="comment"># Start message</span></div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>                response = self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#aedb06b2bcc0533a886a217a19735151d">messageGenerator</a>.generate(start_message)</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>                self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#a7fcc819f6b191473b29534ab67576211">db</a>.save_game_master_prompt(session_id, <span class="stringliteral">&quot;start&quot;</span>, start_message, response)</div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>                print(response)</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>                </div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>                <span class="comment"># World description</span></div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>                world_prompt = world_description_start + <span class="stringliteral">&#39;\n&#39;</span> + self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#aaebaf89191e3696ae060994b3cbd85bd">world_description</a></div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>                response = self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#aedb06b2bcc0533a886a217a19735151d">messageGenerator</a>.generate(world_prompt)</div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>                self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#a7fcc819f6b191473b29534ab67576211">db</a>.save_game_master_prompt(session_id, <span class="stringliteral">&quot;world&quot;</span>, world_prompt, response)</div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>                print(response)</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>                </div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>                <span class="comment"># Character description</span></div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>                response = self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#aedb06b2bcc0533a886a217a19735151d">messageGenerator</a>.generate(formatted_character)</div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span>                self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#a7fcc819f6b191473b29534ab67576211">db</a>.save_game_master_prompt(session_id, <span class="stringliteral">&quot;character&quot;</span>, formatted_character, response)</div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>                print(response)</div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>            <span class="comment"># For existing session, load prompts from database</span></div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>            <span class="keywordflow">for</span> prompt_type, prompt_content, model_response <span class="keywordflow">in</span> self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#a7fcc819f6b191473b29534ab67576211">db</a>.get_game_master_prompts(session_id):</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>                self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#aedb06b2bcc0533a886a217a19735151d">messageGenerator</a>.add_system_message(prompt_content)</div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>                self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#aedb06b2bcc0533a886a217a19735151d">messageGenerator</a>.add_ai_message(model_response)</div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span> </div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>        <span class="comment"># Load existing characters from database</span></div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>        <span class="keywordflow">for</span> name, description <span class="keywordflow">in</span> self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#a7fcc819f6b191473b29534ab67576211">db</a>.get_characters(session_id):</div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>            self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#ab5359c63c972052f22645b0d60df5c38">characters</a>[name] = description</div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span> </div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>        <span class="comment"># Load master message history</span></div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>        master_history = self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#a7fcc819f6b191473b29534ab67576211">db</a>.get_master_messages(session_id)</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>        <span class="keywordflow">for</span> _, user_input, master_output, actor_output <span class="keywordflow">in</span> master_history:</div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>            self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#aedb06b2bcc0533a886a217a19735151d">messageGenerator</a>.add_user_message(user_input)</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>            self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#aedb06b2bcc0533a886a217a19735151d">messageGenerator</a>.add_ai_message(master_output)</div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>            self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#aedb06b2bcc0533a886a217a19735151d">messageGenerator</a>.add_system_message(actor_output)</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span> </div>
</div>
<div class="foldopen" id="foldopen00139" data-start="" data-end="">
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno"><a class="line" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#ada31cf2e334f400a557e5cef5cfd4035">  139</a></span>    <span class="keyword">def </span><a class="code hl_function" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#ada31cf2e334f400a557e5cef5cfd4035">generate_answer</a>(self, message: str) -&gt; str:</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>        <span class="stringliteral">&quot;&quot;&quot;!</span></div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span><span class="stringliteral">        @brief Генерация ответа на сообщение игрока</span></div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span><span class="stringliteral">        </span></div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span><span class="stringliteral">        @param message Сообщение игрока</span></div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span><span class="stringliteral">        </span></div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span><span class="stringliteral">        @return str Ответ системы</span></div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span><span class="stringliteral">        </span></div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span><span class="stringliteral">        @throws PlayerDeathException если игровой персонаж умирает</span></div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>        <span class="comment"># Get the structured output from game master</span></div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>        rules = <span class="stringliteral">&#39;&#39;&#39;</span></div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span><span class="stringliteral">        You also need to follow these rules.</span></div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span><span class="stringliteral">            - You can&#39;t choose a player character in your teams.</span></div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span><span class="stringliteral">            - With any command your answer should always be specific. For example, you can&#39;t write that you need to come to a certain person, it has to be a specific person. You can&#39;t offer an abstract artifact sword, it has to be a specific sword with specific properties. If it takes a little more words, it&#39;s not so critical.</span></div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span><span class="stringliteral">            - If a player enters into a dialogue or performs an action, then he should get an answer, the other person should not just think or ignore it. Except in cases where he wants to ignore you for plot reasons, in which case you should indicate that he is clearly ignoring you intentionally and give a suggestion as to why this is happening.</span></div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span><span class="stringliteral">            - Never describe what the player is doing, always react to the player&#39;s actions, especially if he asked someone a question, he should answer</span></div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span><span class="stringliteral">            - Never write anything in the same line where you select a command, it will break the program.</span></div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span><span class="stringliteral">        &#39;&#39;&#39;</span></div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>        commands, real_game_master_output = self.<a class="code hl_function" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#af4b0a20324399ffd65811c0d5a7e72fb">generate_instruction</a>(message + <span class="stringliteral">&#39;\n&#39;</span> + rules)</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>        game_master_output, active_character_names = self.<a class="code hl_function" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#a7f51c99f6a3adafdebc200086a1e71f2">parse_commands</a>(commands)</div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>        </div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>        <span class="comment"># Create active characters dictionary from the set of names</span></div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>        active_characters = {name: self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#ab5359c63c972052f22645b0d60df5c38">characters</a>[name] <span class="keywordflow">for</span> name <span class="keywordflow">in</span> active_character_names}</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>        self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#ace910641bfd7d3f2a1421aecaea522dd">__actor</a>.update_active_characters(active_characters)</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>        </div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>        <span class="comment"># Generate narrative</span></div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>        final_message = self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#ace910641bfd7d3f2a1421aecaea522dd">__actor</a>.get_detailed_action(game_master_output, message)</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>        actor_message = f<span class="stringliteral">&quot;Actor&#39;s output (What the user will see):\n{final_message}&quot;</span></div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>        </div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>        self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#aedb06b2bcc0533a886a217a19735151d">messageGenerator</a>.add_system_message(actor_message)</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span> </div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>        <span class="comment"># Save user and master messages</span></div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>        self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#a7fcc819f6b191473b29534ab67576211">db</a>.save_user_message(self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#a163bdf238c24c30500cb4d758cd25b31">session_id</a>, message, final_message)</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>        self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#a7fcc819f6b191473b29534ab67576211">db</a>.save_master_message(self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#a163bdf238c24c30500cb4d758cd25b31">session_id</a>, message, real_game_master_output, actor_message)</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>        </div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>        character_ids = []</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>        <span class="keywordflow">for</span> name <span class="keywordflow">in</span> active_characters:</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>            char_id = self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#a7fcc819f6b191473b29534ab67576211">db</a>.get_character_id(self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#a163bdf238c24c30500cb4d758cd25b31">session_id</a>, name)</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>            <span class="keywordflow">if</span> char_id:</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>                character_ids.append(char_id)</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>        </div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>        <span class="comment"># Save active characters to DB</span></div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>        image_prompts = self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#a7fcc819f6b191473b29534ab67576211">db</a>.get_image_prompts(self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#a163bdf238c24c30500cb4d758cd25b31">session_id</a>)</div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>        sequence_number = len(image_prompts)</div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>        self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#a7fcc819f6b191473b29534ab67576211">db</a>.save_active_characters(self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#a163bdf238c24c30500cb4d758cd25b31">session_id</a>, sequence_number, character_ids)</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>        </div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>        <span class="keywordflow">return</span> final_message</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span> </div>
</div>
<div class="foldopen" id="foldopen00188" data-start="" data-end="">
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno"><a class="line" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#af4b0a20324399ffd65811c0d5a7e72fb">  188</a></span>    <span class="keyword">def </span><a class="code hl_function" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#af4b0a20324399ffd65811c0d5a7e72fb">generate_instruction</a>(self, message: str) -&gt; Tuple[List[CommandData], str]:</div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>        <span class="stringliteral">&quot;&quot;&quot;!</span></div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span><span class="stringliteral">        @brief Генерация инструкций на основе сообщения</span></div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span><span class="stringliteral">        </span></div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span><span class="stringliteral">        @param message Сообщение для обработки</span></div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span><span class="stringliteral">        </span></div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span><span class="stringliteral">        @return Tuple[List[CommandData], str] Кортеж из списка команд и текстового вывода</span></div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span><span class="stringliteral">        </span></div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span><span class="stringliteral">        @note Метод может выполнять повторные попытки генерации при некорректном формате</span></div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>        output: str = self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#aedb06b2bcc0533a886a217a19735151d">messageGenerator</a>.generate(message)</div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>        parsed_data, error = self.<a class="code hl_function" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#aa80e8c47e27990d55aeb45ddf7512f05">validate_and_parse</a>(output)</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>        <span class="keywordflow">while</span> parsed_data <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>            time.sleep(5)</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>            logging.info(f<span class="stringliteral">&quot;\n\nOutput: {output}\nError: {error}&quot;</span>)</div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>            output = self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#aedb06b2bcc0533a886a217a19735151d">messageGenerator</a>.generate(</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>                f<span class="stringliteral">&quot;Incorrect formatting. Error: {error}. Repeat using the correct.\n{correct_formatting}&quot;</span>)</div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>            parsed_data, error = self.<a class="code hl_function" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#aa80e8c47e27990d55aeb45ddf7512f05">validate_and_parse</a>(output)</div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span> </div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>        <span class="keywordflow">return</span> parsed_data, output</div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span> </div>
</div>
<div class="foldopen" id="foldopen00209" data-start="" data-end="">
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno"><a class="line" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#aa80e8c47e27990d55aeb45ddf7512f05">  209</a></span>    <span class="keyword">def </span><a class="code hl_function" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#aa80e8c47e27990d55aeb45ddf7512f05">validate_and_parse</a>(self, input_text: str) -&gt; Tuple[Optional[List[CommandData]], str]:</div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span>        <span class="stringliteral">&quot;&quot;&quot;!</span></div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span><span class="stringliteral">        @brief Валидация и парсинг входного текста</span></div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span><span class="stringliteral">        </span></div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span><span class="stringliteral">        @param input_text Текст для валидации и парсинга</span></div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span><span class="stringliteral">        </span></div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span><span class="stringliteral">        @return Tuple[Optional[List[CommandData]], str] Кортеж из списка команд (или None) и сообщения об ошибке</span></div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>        cleaned_text = <span class="stringliteral">&quot;\n&quot;</span>.join([line <span class="keywordflow">for</span> line <span class="keywordflow">in</span> input_text.splitlines() <span class="keywordflow">if</span> line.strip()])</div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>        lines = cleaned_text.strip().split(<span class="stringliteral">&quot;\n&quot;</span>)</div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>        i = 0</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>        parsed_data: List[CommandData] = []</div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>        tmp_characters_names: List[str] = []</div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>        <span class="keywordflow">while</span> i &lt; len(lines):</div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>            line = lines[i].strip()</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span> </div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>            <span class="keywordflow">if</span> line == <span class="stringliteral">&quot;Create character command.&quot;</span>:</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>                <span class="keywordflow">if</span> i + 2 &gt;= len(lines):</div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>                    <span class="keywordflow">return</span> <span class="keywordtype">None</span>, <span class="stringliteral">&quot;Error: Incomplete &#39;Create a character command.&#39;&quot;</span></div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>                name = lines[i + 1].strip()</div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>                <span class="keywordflow">if</span> name <span class="keywordflow">in</span> self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#ab5359c63c972052f22645b0d60df5c38">characters</a> <span class="keywordflow">or</span> name <span class="keywordflow">in</span> tmp_characters_names:</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>                    <span class="keywordflow">return</span> <span class="keywordtype">None</span>, f<span class="stringliteral">&quot;Error: Character name &#39;{name}&#39; already exists.&quot;</span></div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>                description = lines[i + 2].strip()</div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span> </div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>                parsed_data.append(<a class="code hl_class" href="classsrc_1_1_game_master_1_1_command_data_1_1_command_create_character.html">CommandCreateCharacter</a>(</div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>                    name=name,</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>                    description=description</div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>                ))</div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>                tmp_characters_names.append(name)</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>                i += 3</div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span> </div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span>            <span class="keywordflow">elif</span> line == <span class="stringliteral">&quot;Select character command.&quot;</span>:</div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>                <span class="keywordflow">if</span> i + 2 &gt;= len(lines):</div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>                    <span class="keywordflow">return</span> <span class="keywordtype">None</span>, <span class="stringliteral">&quot;Error: Incomplete &#39;Select character command.&#39;&quot;</span></div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>                name = lines[i + 1].strip()</div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>                <span class="keywordflow">if</span> name <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#ab5359c63c972052f22645b0d60df5c38">characters</a> <span class="keywordflow">and</span> name <span class="keywordflow">not</span> <span class="keywordflow">in</span> tmp_characters_names:</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>                    <span class="keywordflow">return</span> <span class="keywordtype">None</span>, f<span class="stringliteral">&quot;Error: Character name &#39;{name}&#39; does not exist.&quot;</span></div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>                action = lines[i + 2].strip()</div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span> </div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span>                parsed_data.append(<a class="code hl_class" href="classsrc_1_1_game_master_1_1_command_data_1_1_command_select_character.html">CommandSelectCharacter</a>(</div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>                    name=name,</div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>                    action=action</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>                ))</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span>                i += 3</div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span> </div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>            <span class="keywordflow">elif</span> line == <span class="stringliteral">&quot;Describe environment command.&quot;</span>:</div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>                <span class="keywordflow">if</span> i + 1 &gt;= len(lines):</div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>                    <span class="keywordflow">return</span> <span class="keywordtype">None</span>, <span class="stringliteral">&quot;Error: Incomplete &#39;The command to describe the environment.&#39;&quot;</span></div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>                description = lines[i + 1].strip()</div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span> </div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>                parsed_data.append(<a class="code hl_class" href="classsrc_1_1_game_master_1_1_command_data_1_1_command_data_environment_description.html">CommandDataEnvironmentDescription</a>(</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>                    description=description</div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>                ))</div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>                i += 2</div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span> </div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>            <span class="keywordflow">elif</span> line == <span class="stringliteral">&quot;Off-topic input command.&quot;</span>:</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>                parsed_data.append(<a class="code hl_class" href="classsrc_1_1_game_master_1_1_command_data_1_1_command_off_topic.html">CommandOffTopic</a>())</div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span>                i += 1</div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span> </div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>            <span class="keywordflow">elif</span> line == <span class="stringliteral">&quot;Player death command.&quot;</span>:</div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>                parsed_data.append(<a class="code hl_class" href="classsrc_1_1_game_master_1_1_command_data_1_1_command_player_death.html">CommandPlayerDeath</a>())</div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>                i += 1</div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span> </div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>            <span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>                <span class="keywordflow">return</span> <span class="keywordtype">None</span>, f<span class="stringliteral">&quot;Error: Unrecognized command &#39;{line}&#39;&quot;</span></div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span>        <span class="keywordflow">if</span> len(parsed_data) == 0:</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>            <span class="keywordflow">return</span> <span class="keywordtype">None</span>, f<span class="stringliteral">&quot;Error: No commands found.&quot;</span></div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span> </div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span>        <span class="keywordflow">return</span> parsed_data, <span class="stringliteral">&quot;No errors found.&quot;</span></div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span> </div>
</div>
<div class="foldopen" id="foldopen00279" data-start="" data-end="">
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno"><a class="line" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#a7f51c99f6a3adafdebc200086a1e71f2">  279</a></span>    <span class="keyword">def </span><a class="code hl_function" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#a7f51c99f6a3adafdebc200086a1e71f2">parse_commands</a>(self, commands: List[CommandData]) -&gt; Tuple[str, Set[str]]:</div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>        <span class="stringliteral">&quot;&quot;&quot;!</span></div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span><span class="stringliteral">        @brief Обработка списка команд</span></div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span><span class="stringliteral">        </span></div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span><span class="stringliteral">        @param commands Список команд для обработки</span></div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span><span class="stringliteral">        </span></div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span><span class="stringliteral">        @return Tuple[str, Set[str]] Кортеж из текстового вывода и множества имен активных персонажей</span></div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span><span class="stringliteral">        </span></div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span><span class="stringliteral">        @throws PlayerDeathException если встречена команда смерти игрока</span></div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span>        final_output = <span class="stringliteral">&quot;&quot;</span></div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>        active_characters: Set[str] = set()</div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span>        <span class="keywordflow">for</span> command <span class="keywordflow">in</span> commands:</div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span>            <span class="keywordflow">if</span> isinstance(command, CommandCreateCharacter):</div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>                self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#ab5359c63c972052f22645b0d60df5c38">characters</a>[command.name] = command.description</div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span>                self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#a7fcc819f6b191473b29534ab67576211">db</a>.save_character(self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#a163bdf238c24c30500cb4d758cd25b31">session_id</a>, command.name, command.description)</div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>                final_output += f<span class="stringliteral">&quot;A new character appears: {command.name}. {command.description}\n&quot;</span></div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span>                active_characters.add(command.name)</div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>                </div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>                <span class="comment"># Generate character portrait if enabled</span></div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>                <span class="keywordflow">if</span> self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#ab19b9e393d293c94e4643cd32c67d0dd">generate_character_images</a> <span class="keywordflow">and</span> self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#ae450110ca0fd166f5a1cf036d7a42faa">__image_manager</a>:</div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span>                    self.<a class="code hl_variable" href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#ae450110ca0fd166f5a1cf036d7a42faa">__image_manager</a>.generate_character_portrait(command.name, command.description)</div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span>                </div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span>            <span class="keywordflow">elif</span> isinstance(command, CommandSelectCharacter):</div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>                final_output += f<span class="stringliteral">&quot;{command.name}: {command.action}\n&quot;</span></div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>                active_characters.add(command.name)</div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>            <span class="keywordflow">elif</span> isinstance(command, CommandDataEnvironmentDescription):</div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>                final_output += f<span class="stringliteral">&quot;Environment: {command.description}\n&quot;</span></div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>            <span class="keywordflow">elif</span> isinstance(command, CommandOffTopic):</div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>                final_output = <span class="stringliteral">&quot;Input is off-topic&quot;</span></div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span>                <span class="keywordflow">break</span></div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>            <span class="keywordflow">elif</span> isinstance(command, CommandPlayerDeath):</div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span>                final_output += <span class="stringliteral">&quot;The player character has died. The session has ended.&quot;</span></div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>                <span class="keywordflow">raise</span> <a class="code hl_class" href="classsrc_1_1_game_master_1_1_game_master_1_1_player_death_exception.html">PlayerDeathException</a>(<span class="stringliteral">&quot;Player character has died. Session ended.&quot;</span>)</div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span>                </div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span>        <span class="keywordflow">return</span> final_output, active_characters</div>
</div>
</div>
<div class="ttc" id="aclasssrc_1_1_actor_1_1_actor_1_1_actor_html"><div class="ttname"><a href="classsrc_1_1_actor_1_1_actor_1_1_actor.html">src.Actor.Actor.Actor</a></div><div class="ttdoc">Реализация актора в игровой системе</div><div class="ttdef"><b>Определения</b> <a href="_actor_8py_source.html#l00012">Actor.py:12</a></div></div>
<div class="ttc" id="aclasssrc_1_1_database_manager_1_1_database_manager_1_1_database_manager_html"><div class="ttname"><a href="classsrc_1_1_database_manager_1_1_database_manager_1_1_database_manager.html">src.DatabaseManager.DatabaseManager.DatabaseManager</a></div><div class="ttdoc">Менеджер базы данных для управления игровыми сессиями</div><div class="ttdef"><b>Определения</b> <a href="_database_manager_8py_source.html#l00008">DatabaseManager.py:8</a></div></div>
<div class="ttc" id="aclasssrc_1_1_game_master_1_1_command_data_1_1_command_create_character_html"><div class="ttname"><a href="classsrc_1_1_game_master_1_1_command_data_1_1_command_create_character.html">src.GameMaster.CommandData.CommandCreateCharacter</a></div><div class="ttdoc">Команда создания нового персонажа</div><div class="ttdef"><b>Определения</b> <a href="_command_data_8py_source.html#l00044">CommandData.py:44</a></div></div>
<div class="ttc" id="aclasssrc_1_1_game_master_1_1_command_data_1_1_command_data_environment_description_html"><div class="ttname"><a href="classsrc_1_1_game_master_1_1_command_data_1_1_command_data_environment_description.html">src.GameMaster.CommandData.CommandDataEnvironmentDescription</a></div><div class="ttdoc">Команда для описания окружения</div><div class="ttdef"><b>Определения</b> <a href="_command_data_8py_source.html#l00016">CommandData.py:16</a></div></div>
<div class="ttc" id="aclasssrc_1_1_game_master_1_1_command_data_1_1_command_off_topic_html"><div class="ttname"><a href="classsrc_1_1_game_master_1_1_command_data_1_1_command_off_topic.html">src.GameMaster.CommandData.CommandOffTopic</a></div><div class="ttdoc">Команда для обработки внеигрового ввода</div><div class="ttdef"><b>Определения</b> <a href="_command_data_8py_source.html#l00059">CommandData.py:59</a></div></div>
<div class="ttc" id="aclasssrc_1_1_game_master_1_1_command_data_1_1_command_player_death_html"><div class="ttname"><a href="classsrc_1_1_game_master_1_1_command_data_1_1_command_player_death.html">src.GameMaster.CommandData.CommandPlayerDeath</a></div><div class="ttdoc">Команда смерти игрового персонажа</div><div class="ttdef"><b>Определения</b> <a href="_command_data_8py_source.html#l00070">CommandData.py:70</a></div></div>
<div class="ttc" id="aclasssrc_1_1_game_master_1_1_command_data_1_1_command_select_character_html"><div class="ttname"><a href="classsrc_1_1_game_master_1_1_command_data_1_1_command_select_character.html">src.GameMaster.CommandData.CommandSelectCharacter</a></div><div class="ttdoc">Команда выбора персонажа для действия</div><div class="ttdef"><b>Определения</b> <a href="_command_data_8py_source.html#l00029">CommandData.py:29</a></div></div>
<div class="ttc" id="aclasssrc_1_1_game_master_1_1_game_master_1_1_game_master_html"><div class="ttname"><a href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html">src.GameMaster.GameMaster.GameMaster</a></div><div class="ttdoc">Класс, управляющий игровым процессом и взаимодействием с игроком</div><div class="ttdef"><b>Определения</b> <a href="#l00029">GameMaster.py:29</a></div></div>
<div class="ttc" id="aclasssrc_1_1_game_master_1_1_game_master_1_1_game_master_html_a0bb1f23554cf5091cf4bffb1641d9be6"><div class="ttname"><a href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#a0bb1f23554cf5091cf4bffb1641d9be6">src.GameMaster.GameMaster.GameMaster.player_description</a></div><div class="ttdeci">player_description</div><div class="ttdef"><b>Определения</b> <a href="#l00067">GameMaster.py:67</a></div></div>
<div class="ttc" id="aclasssrc_1_1_game_master_1_1_game_master_1_1_game_master_html_a163bdf238c24c30500cb4d758cd25b31"><div class="ttname"><a href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#a163bdf238c24c30500cb4d758cd25b31">src.GameMaster.GameMaster.GameMaster.session_id</a></div><div class="ttdeci">session_id</div><div class="ttdef"><b>Определения</b> <a href="#l00057">GameMaster.py:57</a></div></div>
<div class="ttc" id="aclasssrc_1_1_game_master_1_1_game_master_1_1_game_master_html_a3d4c57cdc4cd784782f1fdb024610892"><div class="ttname"><a href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#a3d4c57cdc4cd784782f1fdb024610892">src.GameMaster.GameMaster.GameMaster.__init__</a></div><div class="ttdeci">None __init__(self, int session_id, Optional[str] world_description=None, Optional[str] player_description=None, bool fast_flg=True, str language=&quot;English&quot;, bool generate_character_images=True)</div><div class="ttdoc">Инициализация мастера игры</div><div class="ttdef"><b>Определения</b> <a href="#l00043">GameMaster.py:46</a></div></div>
<div class="ttc" id="aclasssrc_1_1_game_master_1_1_game_master_1_1_game_master_html_a7f51c99f6a3adafdebc200086a1e71f2"><div class="ttname"><a href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#a7f51c99f6a3adafdebc200086a1e71f2">src.GameMaster.GameMaster.GameMaster.parse_commands</a></div><div class="ttdeci">Tuple[str, Set[str]] parse_commands(self, List[CommandData] commands)</div><div class="ttdoc">Обработка списка команд</div><div class="ttdef"><b>Определения</b> <a href="#l00279">GameMaster.py:279</a></div></div>
<div class="ttc" id="aclasssrc_1_1_game_master_1_1_game_master_1_1_game_master_html_a7fcc819f6b191473b29534ab67576211"><div class="ttname"><a href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#a7fcc819f6b191473b29534ab67576211">src.GameMaster.GameMaster.GameMaster.db</a></div><div class="ttdeci">db</div><div class="ttdef"><b>Определения</b> <a href="#l00058">GameMaster.py:58</a></div></div>
<div class="ttc" id="aclasssrc_1_1_game_master_1_1_game_master_1_1_game_master_html_aa80e8c47e27990d55aeb45ddf7512f05"><div class="ttname"><a href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#aa80e8c47e27990d55aeb45ddf7512f05">src.GameMaster.GameMaster.GameMaster.validate_and_parse</a></div><div class="ttdeci">Tuple[Optional[List[CommandData]], str] validate_and_parse(self, str input_text)</div><div class="ttdoc">Валидация и парсинг входного текста</div><div class="ttdef"><b>Определения</b> <a href="#l00209">GameMaster.py:209</a></div></div>
<div class="ttc" id="aclasssrc_1_1_game_master_1_1_game_master_1_1_game_master_html_aaebaf89191e3696ae060994b3cbd85bd"><div class="ttname"><a href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#aaebaf89191e3696ae060994b3cbd85bd">src.GameMaster.GameMaster.GameMaster.world_description</a></div><div class="ttdeci">world_description</div><div class="ttdef"><b>Определения</b> <a href="#l00066">GameMaster.py:66</a></div></div>
<div class="ttc" id="aclasssrc_1_1_game_master_1_1_game_master_1_1_game_master_html_ab19b9e393d293c94e4643cd32c67d0dd"><div class="ttname"><a href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#ab19b9e393d293c94e4643cd32c67d0dd">src.GameMaster.GameMaster.GameMaster.generate_character_images</a></div><div class="ttdeci">generate_character_images</div><div class="ttdef"><b>Определения</b> <a href="#l00059">GameMaster.py:59</a></div></div>
<div class="ttc" id="aclasssrc_1_1_game_master_1_1_game_master_1_1_game_master_html_ab5359c63c972052f22645b0d60df5c38"><div class="ttname"><a href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#ab5359c63c972052f22645b0d60df5c38">src.GameMaster.GameMaster.GameMaster.characters</a></div><div class="ttdeci">dict characters</div><div class="ttdef"><b>Определения</b> <a href="#l00070">GameMaster.py:70</a></div></div>
<div class="ttc" id="aclasssrc_1_1_game_master_1_1_game_master_1_1_game_master_html_ace910641bfd7d3f2a1421aecaea522dd"><div class="ttname"><a href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#ace910641bfd7d3f2a1421aecaea522dd">src.GameMaster.GameMaster.GameMaster.__actor</a></div><div class="ttdeci">__actor</div><div class="ttdef"><b>Определения</b> <a href="#l00071">GameMaster.py:71</a></div></div>
<div class="ttc" id="aclasssrc_1_1_game_master_1_1_game_master_1_1_game_master_html_ada31cf2e334f400a557e5cef5cfd4035"><div class="ttname"><a href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#ada31cf2e334f400a557e5cef5cfd4035">src.GameMaster.GameMaster.GameMaster.generate_answer</a></div><div class="ttdeci">str generate_answer(self, str message)</div><div class="ttdoc">Генерация ответа на сообщение игрока</div><div class="ttdef"><b>Определения</b> <a href="#l00139">GameMaster.py:139</a></div></div>
<div class="ttc" id="aclasssrc_1_1_game_master_1_1_game_master_1_1_game_master_html_ae450110ca0fd166f5a1cf036d7a42faa"><div class="ttname"><a href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#ae450110ca0fd166f5a1cf036d7a42faa">src.GameMaster.GameMaster.GameMaster.__image_manager</a></div><div class="ttdeci">__image_manager</div><div class="ttdef"><b>Определения</b> <a href="#l00072">GameMaster.py:72</a></div></div>
<div class="ttc" id="aclasssrc_1_1_game_master_1_1_game_master_1_1_game_master_html_aedb06b2bcc0533a886a217a19735151d"><div class="ttname"><a href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#aedb06b2bcc0533a886a217a19735151d">src.GameMaster.GameMaster.GameMaster.messageGenerator</a></div><div class="ttdeci">ProtocolMessageGenerator messageGenerator</div><div class="ttdef"><b>Определения</b> <a href="#l00069">GameMaster.py:69</a></div></div>
<div class="ttc" id="aclasssrc_1_1_game_master_1_1_game_master_1_1_game_master_html_af4b0a20324399ffd65811c0d5a7e72fb"><div class="ttname"><a href="classsrc_1_1_game_master_1_1_game_master_1_1_game_master.html#af4b0a20324399ffd65811c0d5a7e72fb">src.GameMaster.GameMaster.GameMaster.generate_instruction</a></div><div class="ttdeci">Tuple[List[CommandData], str] generate_instruction(self, str message)</div><div class="ttdoc">Генерация инструкций на основе сообщения</div><div class="ttdef"><b>Определения</b> <a href="#l00188">GameMaster.py:188</a></div></div>
<div class="ttc" id="aclasssrc_1_1_game_master_1_1_game_master_1_1_player_death_exception_html"><div class="ttname"><a href="classsrc_1_1_game_master_1_1_game_master_1_1_player_death_exception.html">src.GameMaster.GameMaster.PlayerDeathException</a></div><div class="ttdoc">Исключение, возникающее при смерти игрового персонажа</div><div class="ttdef"><b>Определения</b> <a href="#l00018">GameMaster.py:18</a></div></div>
<div class="ttc" id="aclasssrc_1_1_image_manager_1_1_image_manager_1_1_image_manager_html"><div class="ttname"><a href="classsrc_1_1_image_manager_1_1_image_manager_1_1_image_manager.html">src.ImageManager.ImageManager.ImageManager</a></div><div class="ttdoc">Менеджер для управления генерацией и хранением изображений</div><div class="ttdef"><b>Определения</b> <a href="_image_manager_8py_source.html#l00014">ImageManager.py:14</a></div></div>
<div class="ttc" id="aclasssrc_1_1_message_generator_1_1_message_generator_open_router_1_1_message_generator_open_router_html"><div class="ttname"><a href="classsrc_1_1_message_generator_1_1_message_generator_open_router_1_1_message_generator_open_router.html">src.MessageGenerator.MessageGeneratorOpenRouter.MessageGeneratorOpenRouter</a></div><div class="ttdoc">Генератор сообщений с использованием OpenRouter API.</div><div class="ttdef"><b>Определения</b> <a href="_message_generator_open_router_8py_source.html#l00008">MessageGeneratorOpenRouter.py:8</a></div></div>
<div class="ttc" id="anamespacesrc_1_1_actor_1_1_actor_html"><div class="ttname"><a href="namespacesrc_1_1_actor_1_1_actor.html">src.Actor.Actor</a></div><div class="ttdef"><b>Определения</b> <a href="_actor_8py_source.html#l00001">Actor.py:1</a></div></div>
<div class="ttc" id="anamespacesrc_1_1_actor_1_1_protocol_actor_html"><div class="ttname"><a href="namespacesrc_1_1_actor_1_1_protocol_actor.html">src.Actor.ProtocolActor</a></div><div class="ttdef"><b>Определения</b> <a href="_protocol_actor_8py_source.html#l00001">ProtocolActor.py:1</a></div></div>
<div class="ttc" id="anamespacesrc_1_1_database_manager_1_1_database_manager_html"><div class="ttname"><a href="namespacesrc_1_1_database_manager_1_1_database_manager.html">src.DatabaseManager.DatabaseManager</a></div><div class="ttdef"><b>Определения</b> <a href="_database_manager_8py_source.html#l00001">DatabaseManager.py:1</a></div></div>
<div class="ttc" id="anamespacesrc_1_1_descriptions_1_1_character_decription_html"><div class="ttname"><a href="namespacesrc_1_1_descriptions_1_1_character_decription.html">src.Descriptions.CharacterDecription</a></div><div class="ttdef"><b>Определения</b> <a href="_character_decription_8py_source.html#l00001">CharacterDecription.py:1</a></div></div>
<div class="ttc" id="anamespacesrc_1_1_descriptions_1_1_world_decription_html"><div class="ttname"><a href="namespacesrc_1_1_descriptions_1_1_world_decription.html">src.Descriptions.WorldDecription</a></div><div class="ttdef"><b>Определения</b> <a href="_world_decription_8py_source.html#l00001">WorldDecription.py:1</a></div></div>
<div class="ttc" id="anamespacesrc_1_1_game_master_1_1_command_data_html"><div class="ttname"><a href="namespacesrc_1_1_game_master_1_1_command_data.html">src.GameMaster.CommandData</a></div><div class="ttdef"><b>Определения</b> <a href="_command_data_8py_source.html#l00001">CommandData.py:1</a></div></div>
<div class="ttc" id="anamespacesrc_1_1_game_master_1_1_game_master_promts_html"><div class="ttname"><a href="namespacesrc_1_1_game_master_1_1_game_master_promts.html">src.GameMaster.GameMasterPromts</a></div><div class="ttdef"><b>Определения</b> <a href="_game_master_promts_8py_source.html#l00001">GameMasterPromts.py:1</a></div></div>
<div class="ttc" id="anamespacesrc_1_1_image_manager_1_1_image_manager_html"><div class="ttname"><a href="namespacesrc_1_1_image_manager_1_1_image_manager.html">src.ImageManager.ImageManager</a></div><div class="ttdef"><b>Определения</b> <a href="_image_manager_8py_source.html#l00001">ImageManager.py:1</a></div></div>
<div class="ttc" id="anamespacesrc_1_1_message_generator_1_1_message_generator_open_router_html"><div class="ttname"><a href="namespacesrc_1_1_message_generator_1_1_message_generator_open_router.html">src.MessageGenerator.MessageGeneratorOpenRouter</a></div><div class="ttdef"><b>Определения</b> <a href="_message_generator_open_router_8py_source.html#l00001">MessageGeneratorOpenRouter.py:1</a></div></div>
<div class="ttc" id="anamespacesrc_1_1_message_generator_1_1_protocol_message_generator_html"><div class="ttname"><a href="namespacesrc_1_1_message_generator_1_1_protocol_message_generator.html">src.MessageGenerator.ProtocolMessageGenerator</a></div><div class="ttdef"><b>Определения</b> <a href="_protocol_message_generator_8py_source.html#l00001">ProtocolMessageGenerator.py:1</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_15fe2cec17dffb22c04117b383426cd3.html">py</a></li><li class="navelem"><a class="el" href="dir_1bacb7a041c5d8e8f278a4dfcf4ef5b7.html">API</a></li><li class="navelem"><a class="el" href="dir_ba9bc6bf1fb8c5cfdc0d21d8ec27424e.html">src</a></li><li class="navelem"><a class="el" href="dir_59ebbeb22c91e58fd1dac20ab8fae146.html">GameMaster</a></li><li class="navelem"><b>GameMaster.py</b></li>
    <li class="footer">Создано системой <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
