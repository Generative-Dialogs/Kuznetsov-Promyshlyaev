<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.13.2" xml:lang="ru">
  <compounddef id="_game_manager_8py" kind="file" language="Python">
    <compoundname>GameManager.py</compoundname>
    <innerclass refid="class_game_manager_1_1_game_manager" prot="public">GameManager::GameManager</innerclass>
    <innernamespace refid="namespace_game_manager">GameManager</innernamespace>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="keyword">from</highlight><highlight class="normal"><sp/>typing<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>Optional,<sp/>Tuple,<sp/>List</highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/><ref refid="namespacesrc_1_1_game_master_1_1_game_master" kindref="compound">src.GameMaster.GameMaster</ref><sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>GameMaster</highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/><ref refid="namespacesrc_1_1_image_manager_1_1_image_manager" kindref="compound">src.ImageManager.ImageManager</ref><sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>ImageManager</highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/><ref refid="namespacesrc_1_1_database_manager_1_1_database_manager" kindref="compound">src.DatabaseManager.DatabaseManager</ref><sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>DatabaseManager</highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/><ref refid="namespacesrc_1_1_actor_1_1_actor" kindref="compound">src.Actor.Actor</ref><sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>Actor</highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/><ref refid="namespacesrc_1_1_image_prompt_generator_1_1_image_prompt_generator" kindref="compound">src.ImagePromptGenerator.ImagePromptGenerator</ref><sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>ImagePromptGenerator</highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/><ref refid="namespacesrc_1_1_image_generator_1_1_image_generator_google" kindref="compound">src.ImageGenerator.ImageGeneratorGoogle</ref><sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>ImageGeneratorGoogle</highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>src.STT.STT<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>STT</highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>logging</highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight></codeline>
<codeline lineno="12" refid="class_game_manager_1_1_game_manager" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="class_game_manager_1_1_game_manager" kindref="compound">GameManager</ref>:</highlight></codeline>
<codeline lineno="13"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;!</highlight></codeline>
<codeline lineno="14"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>@brief<sp/>Менеджер<sp/>игрового<sp/>процесса</highlight></codeline>
<codeline lineno="15"><highlight class="stringliteral"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="16"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>@details</highlight></codeline>
<codeline lineno="17"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Координирует<sp/>взаимодействие<sp/>между<sp/>различными<sp/>компонентами<sp/>игры:</highlight></codeline>
<codeline lineno="18"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>-<sp/>Мастер<sp/>игры<sp/>(GameMaster)</highlight></codeline>
<codeline lineno="19"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>-<sp/>Менеджер<sp/>изображений<sp/>(ImageManager)</highlight></codeline>
<codeline lineno="20"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>-<sp/>База<sp/>данных<sp/>(DatabaseManager)</highlight></codeline>
<codeline lineno="21"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>-<sp/>Актор<sp/>(Actor)</highlight></codeline>
<codeline lineno="22"><highlight class="stringliteral"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="23"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Отвечает<sp/>за<sp/>обработку<sp/>пользовательского<sp/>ввода<sp/>и<sp/>генерацию<sp/>ответов,</highlight></codeline>
<codeline lineno="24"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>включая<sp/>текстовые<sp/>описания<sp/>и<sp/>изображения.</highlight></codeline>
<codeline lineno="25"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="26"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="27" refid="class_game_manager_1_1_game_manager_1a6383f10322032727e247ff60ce81f15a" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="class_game_manager_1_1_game_manager_1a6383f10322032727e247ff60ce81f15a" kindref="member">__init__</ref>(self,<sp/>session_id:<sp/>int)<sp/>-&gt;<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="28"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;!</highlight></codeline>
<codeline lineno="29"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@brief<sp/>Инициализация<sp/>менеджера<sp/>игры</highlight></codeline>
<codeline lineno="30"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="31"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@param<sp/>session_id<sp/>ID<sp/>игровой<sp/>сессии</highlight></codeline>
<codeline lineno="32"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="33"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@details</highlight></codeline>
<codeline lineno="34"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Создает<sp/>новый<sp/>экземпляр<sp/>менеджера<sp/>игры<sp/>и<sp/>инициализирует</highlight></codeline>
<codeline lineno="35"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>все<sp/>необходимые<sp/>компоненты<sp/>для<sp/>работы<sp/>игровой<sp/>сессии.</highlight></codeline>
<codeline lineno="36"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="37"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="class_game_manager_1_1_game_manager_1af977870e9df12a4120cecf10d1d5647d" kindref="member">__session_id</ref><sp/>=<sp/>session_id</highlight></codeline>
<codeline lineno="38"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="class_game_manager_1_1_game_manager_1a75c754fb86e9204e4375868740743d15" kindref="member">__db</ref><sp/>=<sp/><ref refid="classsrc_1_1_database_manager_1_1_database_manager_1_1_database_manager" kindref="compound">DatabaseManager</ref>()</highlight></codeline>
<codeline lineno="39"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="class_game_manager_1_1_game_manager_1a52c70d5bbb95643dc2ed0d163d8e9eb5" kindref="member">__language</ref><sp/>=<sp/>self.<ref refid="class_game_manager_1_1_game_manager_1a75c754fb86e9204e4375868740743d15" kindref="member">__db</ref>.get_session_language(session_id)</highlight></codeline>
<codeline lineno="40"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="class_game_manager_1_1_game_manager_1a39ffa5cd6276726992b3d78410fcd54d" kindref="member">__game_master</ref><sp/>=<sp/><ref refid="classsrc_1_1_game_master_1_1_game_master_1_1_game_master" kindref="compound">GameMaster</ref>(session_id,<sp/>language=self.<ref refid="class_game_manager_1_1_game_manager_1a52c70d5bbb95643dc2ed0d163d8e9eb5" kindref="member">__language</ref>)</highlight></codeline>
<codeline lineno="41"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="class_game_manager_1_1_game_manager_1a31379ed017e575d546860a7346b38215" kindref="member">__image_manager</ref><sp/>=<sp/><ref refid="classsrc_1_1_image_manager_1_1_image_manager_1_1_image_manager" kindref="compound">ImageManager</ref>(session_id)</highlight></codeline>
<codeline lineno="42"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="class_game_manager_1_1_game_manager_1ad5731f32589712e4113aac7366c5d679" kindref="member">__stt</ref><sp/>=<sp/><ref refid="namespace_s_t_t" kindref="compound">STT</ref>()</highlight></codeline>
<codeline lineno="43"><highlight class="normal"></highlight></codeline>
<codeline lineno="44" refid="class_game_manager_1_1_game_manager_1a9d2e1bd15ba705ae42efbc0dcf1be035" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="class_game_manager_1_1_game_manager_1a9d2e1bd15ba705ae42efbc0dcf1be035" kindref="member">process_audio_input</ref>(self,<sp/>audio_path:<sp/>str,<sp/>generate_image:<sp/>bool<sp/>=<sp/></highlight><highlight class="keyword">True</highlight><highlight class="normal">)<sp/>-&gt;<sp/>Tuple[str,<sp/>Optional[str]]:</highlight></codeline>
<codeline lineno="45"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;!</highlight></codeline>
<codeline lineno="46"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@brief<sp/>Обработка<sp/>аудио<sp/>ввода<sp/>от<sp/>пользователя</highlight></codeline>
<codeline lineno="47"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="48"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@param<sp/>audio_path<sp/>Путь<sp/>к<sp/>аудиофайлу</highlight></codeline>
<codeline lineno="49"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@param<sp/>generate_image<sp/>Флаг<sp/>генерации<sp/>изображения<sp/>(по<sp/>умолчанию<sp/>True)</highlight></codeline>
<codeline lineno="50"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="51"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@return<sp/>Tuple[str,<sp/>Optional[str]]<sp/>Кортеж<sp/>из:</highlight></codeline>
<codeline lineno="52"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-<sp/>Текстового<sp/>ответа<sp/>от<sp/>мастера<sp/>игры</highlight></codeline>
<codeline lineno="53"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-<sp/>Пути<sp/>к<sp/>сгенерированному<sp/>изображению<sp/>(если<sp/>успешно<sp/>и<sp/>generate_image=True)<sp/>или<sp/>None</highlight></codeline>
<codeline lineno="54"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="55"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@details</highlight></codeline>
<codeline lineno="56"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Преобразует<sp/>аудио<sp/>в<sp/>текст<sp/>с<sp/>помощью<sp/>STT<sp/>и<sp/>обрабатывает<sp/>полученный<sp/>текст</highlight></codeline>
<codeline lineno="57"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>через<sp/>process_input.<sp/>Использует<sp/>язык<sp/>сессии<sp/>для<sp/>распознавания<sp/>речи.</highlight></codeline>
<codeline lineno="58"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="class_game_manager_1_1_game_manager_1ad5731f32589712e4113aac7366c5d679" kindref="member">__stt</ref>.set_language(self.<ref refid="class_game_manager_1_1_game_manager_1a52c70d5bbb95643dc2ed0d163d8e9eb5" kindref="member">__language</ref>)</highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>text_input<sp/>=<sp/>self.<ref refid="class_game_manager_1_1_game_manager_1ad5731f32589712e4113aac7366c5d679" kindref="member">__stt</ref>.audio_to_text(audio_path)</highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>text_input<sp/></highlight><highlight class="keywordflow">or</highlight><highlight class="normal"><sp/>text_input<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;Речь<sp/>не<sp/>распознана&quot;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;Извините,<sp/>не<sp/>удалось<sp/>распознать<sp/>речь.<sp/>Пожалуйста,<sp/>попробуйте<sp/>еще<sp/>раз.&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.<ref refid="class_game_manager_1_1_game_manager_1a4322b2bdf33e7468c720e53233ffcbff" kindref="member">process_input</ref>(text_input,<sp/>generate_image)</highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>Exception<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>e:</highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logging.error(f</highlight><highlight class="stringliteral">&quot;Error<sp/>processing<sp/>audio<sp/>input:<sp/>{str(e)}&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>f</highlight><highlight class="stringliteral">&quot;Произошла<sp/>ошибка<sp/>при<sp/>обработке<sp/>аудио:<sp/>{str(e)}&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="72"><highlight class="normal"></highlight></codeline>
<codeline lineno="73" refid="class_game_manager_1_1_game_manager_1a4322b2bdf33e7468c720e53233ffcbff" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="class_game_manager_1_1_game_manager_1a4322b2bdf33e7468c720e53233ffcbff" kindref="member">process_input</ref>(self,<sp/>user_input:<sp/>str,<sp/>generate_image:<sp/>bool<sp/>=<sp/></highlight><highlight class="keyword">True</highlight><highlight class="normal">)<sp/>-&gt;<sp/>Tuple[str,<sp/>Optional[str]]:</highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;!</highlight></codeline>
<codeline lineno="75"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@brief<sp/>Обработка<sp/>пользовательского<sp/>ввода</highlight></codeline>
<codeline lineno="76"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="77"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@param<sp/>user_input<sp/>Ввод<sp/>пользователя</highlight></codeline>
<codeline lineno="78"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@param<sp/>generate_image<sp/>Флаг<sp/>генерации<sp/>изображения<sp/>(по<sp/>умолчанию<sp/>True)</highlight></codeline>
<codeline lineno="79"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="80"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@return<sp/>Tuple[str,<sp/>Optional[str]]<sp/>Кортеж<sp/>из:</highlight></codeline>
<codeline lineno="81"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-<sp/>Текстового<sp/>ответа<sp/>от<sp/>мастера<sp/>игры</highlight></codeline>
<codeline lineno="82"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-<sp/>Пути<sp/>к<sp/>сгенерированному<sp/>изображению<sp/>(если<sp/>успешно<sp/>и<sp/>generate_image=True)<sp/>или<sp/>None</highlight></codeline>
<codeline lineno="83"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="84"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@details</highlight></codeline>
<codeline lineno="85"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Обрабатывает<sp/>пользовательский<sp/>ввод,<sp/>генерирует<sp/>ответ<sp/>и,</highlight></codeline>
<codeline lineno="86"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>при<sp/>необходимости,<sp/>создает<sp/>изображение<sp/>для<sp/>текущей<sp/>сцены.</highlight></codeline>
<codeline lineno="87"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Get<sp/>actor&apos;s<sp/>response<sp/>first</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>text_response<sp/>=<sp/>self.<ref refid="class_game_manager_1_1_game_manager_1a39ffa5cd6276726992b3d78410fcd54d" kindref="member">__game_master</ref>.generate_answer(user_input)</highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>image_prompts<sp/>=<sp/>self.<ref refid="class_game_manager_1_1_game_manager_1a75c754fb86e9204e4375868740743d15" kindref="member">__db</ref>.get_image_prompts(self.<ref refid="class_game_manager_1_1_game_manager_1af977870e9df12a4120cecf10d1d5647d" kindref="member">__session_id</ref>)</highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>current_sequence<sp/>=<sp/>len(image_prompts)</highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>character_ids<sp/>=<sp/>self.<ref refid="class_game_manager_1_1_game_manager_1a75c754fb86e9204e4375868740743d15" kindref="member">__db</ref>.get_active_characters_ids(self.<ref refid="class_game_manager_1_1_game_manager_1af977870e9df12a4120cecf10d1d5647d" kindref="member">__session_id</ref>,<sp/>current_sequence)</highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>image_path<sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>generate_image:</highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>image_path<sp/>=<sp/>self.<ref refid="class_game_manager_1_1_game_manager_1a31379ed017e575d546860a7346b38215" kindref="member">__image_manager</ref>.generate_and_save_image(user_input,<sp/>text_response,<sp/>character_ids)</highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>text_response,<sp/>image_path<sp/></highlight></codeline>
<codeline lineno="100"><highlight class="normal"></highlight></codeline>
<codeline lineno="101" refid="class_game_manager_1_1_game_manager_1a268def76d22d758ba6bab8ddcced4b75" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="class_game_manager_1_1_game_manager_1a268def76d22d758ba6bab8ddcced4b75" kindref="member">generate_image</ref>(self,<sp/>sequence:<sp/>int)<sp/>-&gt;<sp/>Optional[str]:</highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;!</highlight></codeline>
<codeline lineno="103"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@brief<sp/>Генерация<sp/>изображения<sp/>для<sp/>сообщения</highlight></codeline>
<codeline lineno="104"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="105"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@param<sp/>sequence<sp/>Номер<sp/>последовательности<sp/>сообщения</highlight></codeline>
<codeline lineno="106"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="107"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@return<sp/>Optional[str]<sp/>Путь<sp/>к<sp/>сгенерированному<sp/>изображению<sp/>или<sp/>None<sp/>в<sp/>случае<sp/>ошибки</highlight></codeline>
<codeline lineno="108"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="109"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@details</highlight></codeline>
<codeline lineno="110"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Генерирует<sp/>изображение<sp/>для<sp/>указанного<sp/>сообщения,<sp/>используя</highlight></codeline>
<codeline lineno="111"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>данные<sp/>из<sp/>базы<sp/>данных<sp/>и<sp/>активных<sp/>персонажей.</highlight></codeline>
<codeline lineno="112"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>message_data<sp/>=<sp/>self.<ref refid="class_game_manager_1_1_game_manager_1a75c754fb86e9204e4375868740743d15" kindref="member">__db</ref>.get_user_message(self.<ref refid="class_game_manager_1_1_game_manager_1af977870e9df12a4120cecf10d1d5647d" kindref="member">__session_id</ref>,<sp/>sequence)</highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>message_data:</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logging.error(f</highlight><highlight class="stringliteral">&quot;No<sp/>message<sp/>found<sp/>for<sp/>sequence<sp/>{sequence}&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>user_input,<sp/>actor_output<sp/>=<sp/>message_data</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>character_ids<sp/>=<sp/>self.<ref refid="class_game_manager_1_1_game_manager_1a75c754fb86e9204e4375868740743d15" kindref="member">__db</ref>.get_active_characters_ids(self.<ref refid="class_game_manager_1_1_game_manager_1af977870e9df12a4120cecf10d1d5647d" kindref="member">__session_id</ref>,<sp/>sequence)</highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>image_path<sp/>=<sp/>self.<ref refid="class_game_manager_1_1_game_manager_1a31379ed017e575d546860a7346b38215" kindref="member">__image_manager</ref>.generate_and_save_image(user_input,<sp/>actor_output,<sp/>character_ids)</highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>image_path:</highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logging.info(f</highlight><highlight class="stringliteral">&quot;Image<sp/>generated<sp/>and<sp/>saved<sp/>to:<sp/>{image_path}&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>image_path</highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logging.error(</highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>generate<sp/>image&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
    </programlisting>
    <location file="C:/Users/kir/Desktop/py/API/src/GameManager/GameManager.py"/>
  </compounddef>
</doxygen>
