<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<section xmlns="http://docbook.org/ns/docbook" version="5.0" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="__game_manager_8py_source" xml:lang="ru">
<title>GameManager.py</title>
<indexterm><primary>C:/Users/kir/Desktop/py/API/src/GameManager/GameManager.py</primary></indexterm>
<programlisting linenumbering="unnumbered"><anchor xml:id="__game_manager_8py_source_1l00001"/>00001 <emphasis role="keyword">from</emphasis>&#32;typing&#32;<emphasis role="keyword">import</emphasis>&#32;Optional,&#32;Tuple,&#32;List
<anchor xml:id="__game_manager_8py_source_1l00002"/>00002 <emphasis role="keyword">from</emphasis>&#32;<link linkend="_namespacesrc_1_1_game_master_1_1_game_master">src.GameMaster.GameMaster</link>&#32;<emphasis role="keyword">import</emphasis>&#32;GameMaster
<anchor xml:id="__game_manager_8py_source_1l00003"/>00003 <emphasis role="keyword">from</emphasis>&#32;<link linkend="_namespacesrc_1_1_image_manager_1_1_image_manager">src.ImageManager.ImageManager</link>&#32;<emphasis role="keyword">import</emphasis>&#32;ImageManager
<anchor xml:id="__game_manager_8py_source_1l00004"/>00004 <emphasis role="keyword">from</emphasis>&#32;<link linkend="_namespacesrc_1_1_database_manager_1_1_database_manager">src.DatabaseManager.DatabaseManager</link>&#32;<emphasis role="keyword">import</emphasis>&#32;DatabaseManager
<anchor xml:id="__game_manager_8py_source_1l00005"/>00005 <emphasis role="keyword">from</emphasis>&#32;<link linkend="_namespacesrc_1_1_actor_1_1_actor">src.Actor.Actor</link>&#32;<emphasis role="keyword">import</emphasis>&#32;Actor
<anchor xml:id="__game_manager_8py_source_1l00006"/>00006 <emphasis role="keyword">from</emphasis>&#32;<link linkend="_namespacesrc_1_1_image_prompt_generator_1_1_image_prompt_generator">src.ImagePromptGenerator.ImagePromptGenerator</link>&#32;<emphasis role="keyword">import</emphasis>&#32;ImagePromptGenerator
<anchor xml:id="__game_manager_8py_source_1l00007"/>00007 <emphasis role="keyword">from</emphasis>&#32;<link linkend="_namespacesrc_1_1_image_generator_1_1_image_generator_google">src.ImageGenerator.ImageGeneratorGoogle</link>&#32;<emphasis role="keyword">import</emphasis>&#32;ImageGeneratorGoogle
<anchor xml:id="__game_manager_8py_source_1l00008"/>00008 <emphasis role="keyword">from</emphasis>&#32;src.STT.STT&#32;<emphasis role="keyword">import</emphasis>&#32;STT
<anchor xml:id="__game_manager_8py_source_1l00009"/>00009 <emphasis role="keyword">import</emphasis>&#32;logging
<anchor xml:id="__game_manager_8py_source_1l00010"/>00010 
<anchor xml:id="__game_manager_8py_source_1l00011"/>00011 
<anchor xml:id="__game_manager_8py_source_1l00012"/><link linkend="_class_game_manager_1_1_game_manager">00012</link> <emphasis role="keyword">class&#32;</emphasis><link linkend="_class_game_manager_1_1_game_manager">GameManager</link>:
<anchor xml:id="__game_manager_8py_source_1l00013"/>00013 &#32;&#32;&#32;&#32;<emphasis role="stringliteral">&quot;&quot;&quot;!</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00014"/>00014 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;@brief&#32;Менеджер&#32;игрового&#32;процесса</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00015"/>00015 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00016"/>00016 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;@details</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00017"/>00017 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;Координирует&#32;взаимодействие&#32;между&#32;различными&#32;компонентами&#32;игры:</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00018"/>00018 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;-&#32;Мастер&#32;игры&#32;(GameMaster)</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00019"/>00019 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;-&#32;Менеджер&#32;изображений&#32;(ImageManager)</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00020"/>00020 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;-&#32;База&#32;данных&#32;(DatabaseManager)</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00021"/>00021 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;-&#32;Актор&#32;(Actor)</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00022"/>00022 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00023"/>00023 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;Отвечает&#32;за&#32;обработку&#32;пользовательского&#32;ввода&#32;и&#32;генерацию&#32;ответов,</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00024"/>00024 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;включая&#32;текстовые&#32;описания&#32;и&#32;изображения.</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00025"/>00025 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;&quot;&quot;&quot;</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00026"/>00026 &#32;&#32;&#32;&#32;
<anchor xml:id="__game_manager_8py_source_1l00027"/><link linkend="_class_game_manager_1_1_game_manager_1a6383f10322032727e247ff60ce81f15a">00027</link> &#32;&#32;&#32;&#32;<emphasis role="keyword">def&#32;</emphasis><link linkend="_class_game_manager_1_1_game_manager_1a6383f10322032727e247ff60ce81f15a">__init__</link>(self,&#32;session_id:&#32;int)&#32;-&gt;&#32;<emphasis role="keywordtype">None</emphasis>:
<anchor xml:id="__game_manager_8py_source_1l00028"/>00028 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="stringliteral">&quot;&quot;&quot;!</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00029"/>00029 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;@brief&#32;Инициализация&#32;менеджера&#32;игры</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00030"/>00030 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00031"/>00031 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;@param&#32;session_id&#32;ID&#32;игровой&#32;сессии</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00032"/>00032 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00033"/>00033 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;@details</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00034"/>00034 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;Создает&#32;новый&#32;экземпляр&#32;менеджера&#32;игры&#32;и&#32;инициализирует</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00035"/>00035 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;все&#32;необходимые&#32;компоненты&#32;для&#32;работы&#32;игровой&#32;сессии.</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00036"/>00036 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&quot;&quot;&quot;</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00037"/>00037 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;self.<link linkend="_class_game_manager_1_1_game_manager_1af977870e9df12a4120cecf10d1d5647d">__session_id</link>&#32;=&#32;session_id
<anchor xml:id="__game_manager_8py_source_1l00038"/>00038 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;self.<link linkend="_class_game_manager_1_1_game_manager_1a75c754fb86e9204e4375868740743d15">__db</link>&#32;=&#32;<link linkend="_classsrc_1_1_database_manager_1_1_database_manager_1_1_database_manager">DatabaseManager</link>()
<anchor xml:id="__game_manager_8py_source_1l00039"/>00039 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;self.<link linkend="_class_game_manager_1_1_game_manager_1a52c70d5bbb95643dc2ed0d163d8e9eb5">__language</link>&#32;=&#32;self.<link linkend="_class_game_manager_1_1_game_manager_1a75c754fb86e9204e4375868740743d15">__db</link>.get_session_language(session_id)
<anchor xml:id="__game_manager_8py_source_1l00040"/>00040 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;self.<link linkend="_class_game_manager_1_1_game_manager_1a39ffa5cd6276726992b3d78410fcd54d">__game_master</link>&#32;=&#32;<link linkend="_classsrc_1_1_game_master_1_1_game_master_1_1_game_master">GameMaster</link>(session_id,&#32;language=self.<link linkend="_class_game_manager_1_1_game_manager_1a52c70d5bbb95643dc2ed0d163d8e9eb5">__language</link>)
<anchor xml:id="__game_manager_8py_source_1l00041"/>00041 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;self.<link linkend="_class_game_manager_1_1_game_manager_1a31379ed017e575d546860a7346b38215">__image_manager</link>&#32;=&#32;<link linkend="_classsrc_1_1_image_manager_1_1_image_manager_1_1_image_manager">ImageManager</link>(session_id)
<anchor xml:id="__game_manager_8py_source_1l00042"/>00042 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;self.<link linkend="_class_game_manager_1_1_game_manager_1ad5731f32589712e4113aac7366c5d679">__stt</link>&#32;=&#32;<link linkend="_namespace_s_t_t">STT</link>()
<anchor xml:id="__game_manager_8py_source_1l00043"/>00043 
<anchor xml:id="__game_manager_8py_source_1l00044"/><link linkend="_class_game_manager_1_1_game_manager_1a9d2e1bd15ba705ae42efbc0dcf1be035">00044</link> &#32;&#32;&#32;&#32;<emphasis role="keyword">def&#32;</emphasis><link linkend="_class_game_manager_1_1_game_manager_1a9d2e1bd15ba705ae42efbc0dcf1be035">process_audio_input</link>(self,&#32;audio_path:&#32;str,&#32;generate_image:&#32;bool&#32;=&#32;<emphasis role="keyword">True</emphasis>)&#32;-&gt;&#32;Tuple[str,&#32;Optional[str]]:
<anchor xml:id="__game_manager_8py_source_1l00045"/>00045 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="stringliteral">&quot;&quot;&quot;!</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00046"/>00046 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;@brief&#32;Обработка&#32;аудио&#32;ввода&#32;от&#32;пользователя</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00047"/>00047 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00048"/>00048 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;@param&#32;audio_path&#32;Путь&#32;к&#32;аудиофайлу</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00049"/>00049 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;@param&#32;generate_image&#32;Флаг&#32;генерации&#32;изображения&#32;(по&#32;умолчанию&#32;True)</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00050"/>00050 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00051"/>00051 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;@return&#32;Tuple[str,&#32;Optional[str]]&#32;Кортеж&#32;из:</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00052"/>00052 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;-&#32;Текстового&#32;ответа&#32;от&#32;мастера&#32;игры</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00053"/>00053 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;-&#32;Пути&#32;к&#32;сгенерированному&#32;изображению&#32;(если&#32;успешно&#32;и&#32;generate_image=True)&#32;или&#32;None</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00054"/>00054 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00055"/>00055 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;@details</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00056"/>00056 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;Преобразует&#32;аудио&#32;в&#32;текст&#32;с&#32;помощью&#32;STT&#32;и&#32;обрабатывает&#32;полученный&#32;текст</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00057"/>00057 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;через&#32;process_input.&#32;Использует&#32;язык&#32;сессии&#32;для&#32;распознавания&#32;речи.</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00058"/>00058 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&quot;&quot;&quot;</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00059"/>00059 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">try</emphasis>:
<anchor xml:id="__game_manager_8py_source_1l00060"/>00060 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;self.<link linkend="_class_game_manager_1_1_game_manager_1ad5731f32589712e4113aac7366c5d679">__stt</link>.set_language(self.<link linkend="_class_game_manager_1_1_game_manager_1a52c70d5bbb95643dc2ed0d163d8e9eb5">__language</link>)
<anchor xml:id="__game_manager_8py_source_1l00061"/>00061 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;
<anchor xml:id="__game_manager_8py_source_1l00062"/>00062 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;text_input&#32;=&#32;self.<link linkend="_class_game_manager_1_1_game_manager_1ad5731f32589712e4113aac7366c5d679">__stt</link>.audio_to_text(audio_path)
<anchor xml:id="__game_manager_8py_source_1l00063"/>00063 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;
<anchor xml:id="__game_manager_8py_source_1l00064"/>00064 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;<emphasis role="keywordflow">not</emphasis>&#32;text_input&#32;<emphasis role="keywordflow">or</emphasis>&#32;text_input&#32;==&#32;<emphasis role="stringliteral">&quot;Речь&#32;не&#32;распознана&quot;</emphasis>:
<anchor xml:id="__game_manager_8py_source_1l00065"/>00065 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<emphasis role="stringliteral">&quot;Извините,&#32;не&#32;удалось&#32;распознать&#32;речь.&#32;Пожалуйста,&#32;попробуйте&#32;еще&#32;раз.&quot;</emphasis>,&#32;<emphasis role="keywordtype">None</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00066"/>00066 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;
<anchor xml:id="__game_manager_8py_source_1l00067"/>00067 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;self.<link linkend="_class_game_manager_1_1_game_manager_1a4322b2bdf33e7468c720e53233ffcbff">process_input</link>(text_input,&#32;generate_image)
<anchor xml:id="__game_manager_8py_source_1l00068"/>00068 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;
<anchor xml:id="__game_manager_8py_source_1l00069"/>00069 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">except</emphasis>&#32;Exception&#32;<emphasis role="keyword">as</emphasis>&#32;e:
<anchor xml:id="__game_manager_8py_source_1l00070"/>00070 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;logging.error(f<emphasis role="stringliteral">&quot;Error&#32;processing&#32;audio&#32;input:&#32;{str(e)}&quot;</emphasis>)
<anchor xml:id="__game_manager_8py_source_1l00071"/>00071 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;f<emphasis role="stringliteral">&quot;Произошла&#32;ошибка&#32;при&#32;обработке&#32;аудио:&#32;{str(e)}&quot;</emphasis>,&#32;<emphasis role="keywordtype">None</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00072"/>00072 
<anchor xml:id="__game_manager_8py_source_1l00073"/><link linkend="_class_game_manager_1_1_game_manager_1a4322b2bdf33e7468c720e53233ffcbff">00073</link> &#32;&#32;&#32;&#32;<emphasis role="keyword">def&#32;</emphasis><link linkend="_class_game_manager_1_1_game_manager_1a4322b2bdf33e7468c720e53233ffcbff">process_input</link>(self,&#32;user_input:&#32;str,&#32;generate_image:&#32;bool&#32;=&#32;<emphasis role="keyword">True</emphasis>)&#32;-&gt;&#32;Tuple[str,&#32;Optional[str]]:
<anchor xml:id="__game_manager_8py_source_1l00074"/>00074 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="stringliteral">&quot;&quot;&quot;!</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00075"/>00075 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;@brief&#32;Обработка&#32;пользовательского&#32;ввода</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00076"/>00076 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00077"/>00077 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;@param&#32;user_input&#32;Ввод&#32;пользователя</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00078"/>00078 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;@param&#32;generate_image&#32;Флаг&#32;генерации&#32;изображения&#32;(по&#32;умолчанию&#32;True)</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00079"/>00079 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00080"/>00080 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;@return&#32;Tuple[str,&#32;Optional[str]]&#32;Кортеж&#32;из:</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00081"/>00081 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;-&#32;Текстового&#32;ответа&#32;от&#32;мастера&#32;игры</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00082"/>00082 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;-&#32;Пути&#32;к&#32;сгенерированному&#32;изображению&#32;(если&#32;успешно&#32;и&#32;generate_image=True)&#32;или&#32;None</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00083"/>00083 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00084"/>00084 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;@details</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00085"/>00085 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;Обрабатывает&#32;пользовательский&#32;ввод,&#32;генерирует&#32;ответ&#32;и,</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00086"/>00086 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;при&#32;необходимости,&#32;создает&#32;изображение&#32;для&#32;текущей&#32;сцены.</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00087"/>00087 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&quot;&quot;&quot;</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00088"/>00088 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">#&#32;Get&#32;actor&apos;s&#32;response&#32;first</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00089"/>00089 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;text_response&#32;=&#32;self.<link linkend="_class_game_manager_1_1_game_manager_1a39ffa5cd6276726992b3d78410fcd54d">__game_master</link>.generate_answer(user_input)
<anchor xml:id="__game_manager_8py_source_1l00090"/>00090 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;
<anchor xml:id="__game_manager_8py_source_1l00091"/>00091 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;image_prompts&#32;=&#32;self.<link linkend="_class_game_manager_1_1_game_manager_1a75c754fb86e9204e4375868740743d15">__db</link>.get_image_prompts(self.<link linkend="_class_game_manager_1_1_game_manager_1af977870e9df12a4120cecf10d1d5647d">__session_id</link>)
<anchor xml:id="__game_manager_8py_source_1l00092"/>00092 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;current_sequence&#32;=&#32;len(image_prompts)
<anchor xml:id="__game_manager_8py_source_1l00093"/>00093 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;character_ids&#32;=&#32;self.<link linkend="_class_game_manager_1_1_game_manager_1a75c754fb86e9204e4375868740743d15">__db</link>.get_active_characters_ids(self.<link linkend="_class_game_manager_1_1_game_manager_1af977870e9df12a4120cecf10d1d5647d">__session_id</link>,&#32;current_sequence)
<anchor xml:id="__game_manager_8py_source_1l00094"/>00094 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;
<anchor xml:id="__game_manager_8py_source_1l00095"/>00095 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;image_path&#32;=&#32;<emphasis role="keywordtype">None</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00096"/>00096 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;generate_image:
<anchor xml:id="__game_manager_8py_source_1l00097"/>00097 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;image_path&#32;=&#32;self.<link linkend="_class_game_manager_1_1_game_manager_1a31379ed017e575d546860a7346b38215">__image_manager</link>.generate_and_save_image(user_input,&#32;text_response,&#32;character_ids)
<anchor xml:id="__game_manager_8py_source_1l00098"/>00098 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;
<anchor xml:id="__game_manager_8py_source_1l00099"/>00099 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;text_response,&#32;image_path&#32;
<anchor xml:id="__game_manager_8py_source_1l00100"/>00100 
<anchor xml:id="__game_manager_8py_source_1l00101"/><link linkend="_class_game_manager_1_1_game_manager_1a268def76d22d758ba6bab8ddcced4b75">00101</link> &#32;&#32;&#32;&#32;<emphasis role="keyword">def&#32;</emphasis><link linkend="_class_game_manager_1_1_game_manager_1a268def76d22d758ba6bab8ddcced4b75">generate_image</link>(self,&#32;sequence:&#32;int)&#32;-&gt;&#32;Optional[str]:
<anchor xml:id="__game_manager_8py_source_1l00102"/>00102 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="stringliteral">&quot;&quot;&quot;!</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00103"/>00103 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;@brief&#32;Генерация&#32;изображения&#32;для&#32;сообщения</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00104"/>00104 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00105"/>00105 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;@param&#32;sequence&#32;Номер&#32;последовательности&#32;сообщения</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00106"/>00106 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00107"/>00107 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;@return&#32;Optional[str]&#32;Путь&#32;к&#32;сгенерированному&#32;изображению&#32;или&#32;None&#32;в&#32;случае&#32;ошибки</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00108"/>00108 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00109"/>00109 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;@details</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00110"/>00110 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;Генерирует&#32;изображение&#32;для&#32;указанного&#32;сообщения,&#32;используя</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00111"/>00111 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;данные&#32;из&#32;базы&#32;данных&#32;и&#32;активных&#32;персонажей.</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00112"/>00112 <emphasis role="stringliteral">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&quot;&quot;&quot;</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00113"/>00113 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;message_data&#32;=&#32;self.<link linkend="_class_game_manager_1_1_game_manager_1a75c754fb86e9204e4375868740743d15">__db</link>.get_user_message(self.<link linkend="_class_game_manager_1_1_game_manager_1af977870e9df12a4120cecf10d1d5647d">__session_id</link>,&#32;sequence)
<anchor xml:id="__game_manager_8py_source_1l00114"/>00114 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;<emphasis role="keywordflow">not</emphasis>&#32;message_data:
<anchor xml:id="__game_manager_8py_source_1l00115"/>00115 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;logging.error(f<emphasis role="stringliteral">&quot;No&#32;message&#32;found&#32;for&#32;sequence&#32;{sequence}&quot;</emphasis>)
<anchor xml:id="__game_manager_8py_source_1l00116"/>00116 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<emphasis role="keywordtype">None</emphasis>
<anchor xml:id="__game_manager_8py_source_1l00117"/>00117 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;
<anchor xml:id="__game_manager_8py_source_1l00118"/>00118 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;user_input,&#32;actor_output&#32;=&#32;message_data
<anchor xml:id="__game_manager_8py_source_1l00119"/>00119 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;
<anchor xml:id="__game_manager_8py_source_1l00120"/>00120 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;character_ids&#32;=&#32;self.<link linkend="_class_game_manager_1_1_game_manager_1a75c754fb86e9204e4375868740743d15">__db</link>.get_active_characters_ids(self.<link linkend="_class_game_manager_1_1_game_manager_1af977870e9df12a4120cecf10d1d5647d">__session_id</link>,&#32;sequence)
<anchor xml:id="__game_manager_8py_source_1l00121"/>00121 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;
<anchor xml:id="__game_manager_8py_source_1l00122"/>00122 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;image_path&#32;=&#32;self.<link linkend="_class_game_manager_1_1_game_manager_1a31379ed017e575d546860a7346b38215">__image_manager</link>.generate_and_save_image(user_input,&#32;actor_output,&#32;character_ids)
<anchor xml:id="__game_manager_8py_source_1l00123"/>00123 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;image_path:
<anchor xml:id="__game_manager_8py_source_1l00124"/>00124 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;logging.info(f<emphasis role="stringliteral">&quot;Image&#32;generated&#32;and&#32;saved&#32;to:&#32;{image_path}&quot;</emphasis>)
<anchor xml:id="__game_manager_8py_source_1l00125"/>00125 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;image_path
<anchor xml:id="__game_manager_8py_source_1l00126"/>00126 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">else</emphasis>:
<anchor xml:id="__game_manager_8py_source_1l00127"/>00127 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;logging.error(<emphasis role="stringliteral">&quot;Failed&#32;to&#32;generate&#32;image&quot;</emphasis>)
<anchor xml:id="__game_manager_8py_source_1l00128"/>00128 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<emphasis role="keywordtype">None</emphasis>
</programlisting></section>
